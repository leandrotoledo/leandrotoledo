{% extends 'base.html' %}

{% load comments %}
{% load url from future %}

{% block title %}{{ post.title }}{% endblock %}
{% block description %}{{ post.excerpt }}{% endblock %}

{% block articles %}
    <article class="article detail" itemscope itemtype="http://schema.org/BlogPosting">
        <header>
            <h2 class="title"><a href="{{ post.get_absolute_url }}"><span itemprop="name">{{ post.title }}</span></a></h2>
             <ul>
                <li class="published-date">por <a rel="author" href="https://profiles.google.com/{{ author.userprofile.google_profile }}/" target="_blank"><span itemprop="author">{{ author.first_name }} {{ author.last_name }}</span></a> em <time datetime="{{ post.published_date|date:'Y-m-d' }}"><span itemprop="datePublished">{{ post.published_date|date:'d/m/Y' }}</span></time></li>
                <li class="keywords">Categoria(s):
                    <div itemprop="keywords">
                        <ul>
                        {% for category in post.category.all %}
                            <li><a href="">{{ category }}</a></li>
                        {% endfor %}
                        </ul>
                    </div>
                </li>
                <li class="comments">
                    {% get_comment_count for post as comment_count %}
                    {% if comment_count > 0 %}
                        <a href="{{ post.get_absolute_url }}#comments-section">{{ comment_count }} comentário(s)</a>
                    {% else %}
                        <a href="{{ post.get_absolute_url }}#comments-form">Deixe um comentário</a>
                    {% endif %}
                </li>
            </ul>
        </header>

        <div class="excerpt" itemprop="description">
            {{ post.excerpt|safe|escape }}
        </div>

        <div class="content">
            {{ post.content|safe|escape }}
        </div>

        <br />

        <div id="comments">
            {% get_comment_count for post as comment_count %}
            {% if comment_count > 0 %}
                <h2 class="comments-anchor"><a id="comments-section">{{ comment_count }} resposta(s) para este artigo</a></h2>
                {% get_comment_list for post as comment_list %}
                {% for comment in comment_list %}
                    <article>
                        <ul>
                            {% if comment.user_url %}
                            <li class="username"><a href="{{ comment.user_url }}" target="_blank">{{ comment.user_name }}</a></li>
                            {% else %}
                            <li class="username"><strong>{{ comment.user_name }}</strong></li>
                            {% endif %}
                        </ul>

                        <div class="content">{{ comment.comment }}</div>

                        <ul>
                            <li class="published-date"><a id="c{{ comment.pk }}" href="{{ post.get_absolute_url }}#c{{ comment.pk }}">em <time datetime="{{ comment.submit_date|date:'c' }}">{{ comment.submit_date|date:'d/m/Y \à\s h:i A' }}</time></a></li>
                        </ul>

                    </article>
                    <br />
                {% endfor %}
            {% endif %}

            {% get_comment_form for post as form %}
            <h2 class="comments-anchor"><a id="comments-form">Deixe um comentário</a></h2>
            <form action="{% comment_form_target %}" method="post">
                {% csrf_token %}
                {{ form.as_p }}
                <input type="hidden" name="next" value="{{ post.get_absolute_url }}" />
                <input type="submit" name="submit" value="Publicar">
            </form>
        </div>
    </article>
{% endblock %}
